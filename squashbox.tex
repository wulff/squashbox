\documentclass[ebook,10pt,twoside,openright]{memoir}

\usepackage[T1]{fontenc}
%\usepackage[danish]{babel,varioref}
\usepackage[utf8]{inputenc}

% include book-specific macros and settings
\usepackage{squashbox}

% set title page content
\title{SquashBox}
\author{Morten Wulff}
\date{\today}

% add extra options to hyperref if we're generating a pdf
\ifpdf
	\usepackage[pdfauthor={Morten Wulff},%
	            pdftitle={\thetitle},%
	            pdfdisplaydoctitle=true,%
	            hypertexnames=false,%
	            plainpages=false,%
	            pdftex]{hyperref}
\else
	\usepackage{hyperref}
\fi
\usepackage{memhfixc}

\begin{document}

\frontmatter

% create title pages
\squashboxhalftitlepage{\thetitle}
\squashboxtitlepage{A virtual development environment based on VirtualBox, Ubuntu, and NetBeans.}{\thetitle}{}

\include{copyright}

% create toc with no page number on the first page
\begingroup
\aliaspagestyle{chapter}{empty}
\tableofcontents*
\endgroup

% ============================================================================
\chapter{Preface}

\section*{Audience}

This guide assumes that you know your way around your computer. You do not have to be a super user, but it will definitely help if you have tried installing a couple of CMS'es on your local machine or on shared hosting.

% TODO: expand this section

\section*{Conventions used in this guide}

\begingroup
\setlength{\parindent}{0pt}

This guide uses the following typographical conventions:

\begin{description}
\item[\normalfont\emph{Italic}] Indicates file names, folders, module and package names, new terms, and emphasized text.
\item[\normalfont\texttt{Fixed width}] Indicates code, file contents, commands, and terminal output.
\end{description}

Arrows are used to indicate navigation of a web site or application menus:

\vspace{0.5\baselineskip}
\hspace{2\baselineskip}\emph{Structure $\rightarrow$ Content types $\rightarrow$ Add content type}
\vspace{0.5\baselineskip}

This indicates that you should click on the link \emph{Structure}, then on the link \emph{Content types} and finally click on the link \emph{Add content type}.

% TODO: add example for navigating netbeans menus.

\endgroup

\mainmatter

\part{Setting up shop}

% ============================================================================
\chapter{Base system} \label{chbasesystem}
\chapterprecis{Download and install the latest version of Ubuntu on your computer or in a virtual machine.}

\noindent
Before we get started you must decide if you want to install your development system on a physical machine (e.g. that spare laptop you have lying around) or in a virtual machine on your computer.

If you decide to install on a physical machine, you only need to read the sections \emph{Download Ubuntu} on page \ref{secdownloadubuntu} and \emph{Install Ubuntu} on page \ref{secinstallubuntu}.

% ----------------------------------------------------------------------------
\section{Download Ubuntu} \label{secdownloadubuntu}

To get started, you need to download the latest version of the Ubuntu Desktop Edition (currently, this is version 10.10, nicknamed Maverick Meerkat). Go to the Ubuntu site and click the big \emph{Download Ubuntu} button.

\squashboxlink{http://www.ubuntu.com/}

On the download page, simply click the \emph{Start download} button to download the default version of the Desktop Edition.

\squashboxscreenshot{base/downloadubuntu.png}{Download the recommended version of Ubuntu}{figdownloadubuntu}

If you are planning to install Ubuntu on a spare machine or alongside your existing operating system, you should follow the second step of the guide on the download page to either burn a CD or create a USB drive for installing Ubuntu.

% ----------------------------------------------------------------------------
\section{Install VirtualBox} \label{secinstallvirtualbox}

Multiple products are available for setting up virtual machines on your computer, e.g. \hreffoot{http://www.vmware.com/products/fusion/}{VMWare Fusion}, \hreffoot{http://www.vmware.com/products/workstation/}{VMWare Workstation}, and \hreffoot{http://www.parallels.com/eu/computing/}{Parallels Desktop}.

This guide uses the open source VirtualBox products, which is available for Mac OS, Windows, and Linux. Go to the download page and pick the installation package that matches your operating system.

\squashboxlink{http://www.virtualbox.org/wiki/Downloads}

Once you have downloaded the package, you can run it and follow the steps in the installer to setup VirtualBox. This guide does not cover the VirtualBox installation process in detail. Please refer to the documentation on the VirtualBox site.

When VirtualBox is installed, you can execute it and start configuring your first virtual machine.

\squashboxscreenshot{base/virtualboxwelcome.png}{VirtualBox manager}{figvirtualboxwelcome}

In the VirtualBox Manager (see figure \ref{figvirtualboxwelcome}), click the \emph{New} button to start the \emph{Virtual Machine Wizard}. When you click \emph{Continue} on the first page of the wizard, it is time to select which operating system the virtual machine will be running and giving it a memorable name. We'll call the machine \emph{SquashBox} and tell the wizard that it will be running Ubuntu (see figure \ref{figvirtualboxwizardname}).

\squashboxscreenshot{base/virtualboxwizardname.png}{Naming your virtual machine}{figvirtualboxwizardname}

Since this virtual machine will be used for development and debugging, we will assign 1024~MB of memory to it. If you have \emph{lots} of free memory, or if you plan to use the virtual machine as your primary development environment, you can increase this. The wizard indicates how much memory you can safely allocate to the virtual machine (see figure \ref{figvirtualboxwizardmemory}).

\squashboxscreenshot{base/virtualboxwizardmemory.png}{Allocating memory to the virtual machine}{figvirtualboxwizardmemory}

The next step is to create a virtual disk for the virtual machine. Instead of using a physical hard disk in your machine, the virtual machine uses one or more files on your file system to emulate a hard disk. We'll stick with the default settings and create a new hard disk with 8~GB of space (see figure \ref{figvirtualboxwizarddisk}).

\squashboxscreenshot{base/virtualboxwizarddisk.png}{Creating a virtual disk for the virtual machine}{figvirtualboxwizarddisk}

Click \emph{Continue} to open the \emph{Create new virtual disk} wizard. You can choose between fixed-size storage and dynamically expanding storage. We'll choose the dynamic option to make sure that the virtual disk doesn't take up more space than necessary (see figure \ref{figvirtualboxwizarddisktype}).

\squashboxscreenshot{base/virtualboxwizarddisktype.png}{Selecting the hard disk storage type}{figvirtualboxwizarddisktype}

When you have selected a storage type, you can set the size and location of the virtual disk. By default, the virtual disk is placed in the same folder as the virtual machine definition. If you have enough free space on your hard disk you probably don't have to change the locations, but it can be handy if you want to put the virtual disk on another partition or drive (see figure \ref{figvirtualboxwizarddisklocation}). When you have reviewed the settings for the new disk, you can click \emph{Done} to create the disk and exit the wizard.

\squashboxscreenshot{base/virtualboxwizarddisklocation.png}{Selecting the location and size of the virtual disk}{figvirtualboxwizarddisklocation}

Finally, you can review the settings of your new virtual machine and click \emph{Done} in the main wizard to create the machine and exit the wizard.

Before you can boot your shiny new virtual machine, you have to make a few changes to its settings. Click the \emph{Settings} button in the VirtualBox Manager to change the display settings and attach the Ubuntu CD image you downloaded earlier.

Start by clicking the \emph{Display} tab and adding some video memory. We will make 64~MB available to the guest operating system (see figure \ref{figvirtualboxconfiguredisplay}).

\squashboxscreenshot{base/virtualboxconfiguredisplay.png}{Display settings}{figvirtualboxconfiguredisplay}

To be able to boot from the Ubuntu CD image, you must attach it to the virtual machine. Go to the \emph{Storage} tab and select the empty slot beneath the IDE controller. Click the little disk icon next to the attributes dropdown, select \emph{Choose a virtual CD/DVD disk file}, and select the Ubuntu Desktop disk image (see figure \ref{figvirtualboxconfigurestorage}).

\squashboxscreenshot{base/virtualboxconfigurestorage.png}{Storage settings}{figvirtualboxconfigurestorage}

Now you are ready to install Ubuntu Desktop Edition on your virtual machine!

\squashboxscreenshot{base/virtualboxmanager.png}{VirtualBox Manager}{figvirtualboxmanager}

% ----------------------------------------------------------------------------
\section{Install Ubuntu} \label{secinstallubuntu}

To start the installation, select your virtual machine in the VirtualBox Manager (see figure \ref{figvirtualboxmanager}) and click the \emph{Start} button in the toolbar. The virtual machine will boot from the CD image you attached to it in the previous section.

% TODO: or boot from the CD or USB stick

When the machine has finished booting, you will be presented with the Ubuntu installer. Click \emph{Install Ubuntu} to install Ubuntu on your virtual machine (see figure \ref{figubuntuinstaller}).

\squashboxscreenshot{base/ubuntuinstaller.png}{Ubuntu installer}{figubuntuinstaller}

On the next screen, you can confirm that your virtual machine satisfies Ubuntu's requirements. If you are connected to the internet when you are doing the install, you can choose to download all necessary software updates during the installation process (see figure \ref{figubuntupreparing}).

\squashboxscreenshot{base/ubuntupreparing.png}{Preparing to install Ubuntu}{figubuntupreparing}

The next step is to allocate drive space to the Ubuntu installation. Since we are giving over the entire virtual machine to Ubuntu, we will stick to the default and erase the entire virtual disk (see figure \ref{figubuntuallocate}).

\squashboxscreenshot{base/ubuntuallocate.png}{Allocate drive space}{figubuntuallocate}

If you are not having any second thoughts, you can press the \emph{Install Now} button to start the actual installation (see figure \ref{figubuntuinstallnow}).

\squashboxscreenshot{base/ubuntuinstallnow.png}{Start the installation process}{figubuntuinstallnow}

While the installer copies all the files to your virtual hard disk, you must configure your time zone and keyboard layout, and create a user account.

First, you must select your time zone. This will make sure that all dates and times display correctly. You can either perform the selection by clicking on the world map or by entering the name of the nearest major city in the search field below the map (see figure \ref{figubuntulocale}).

\squashboxscreenshot{base/ubuntulocale.png}{Select your locale}{figubuntulocale}

Next, you must select a keyboard layout. Select your country in the list on the left and choose the specific layout in the list on the right (see figure \ref{figubuntukeyboard}). If you are not sure of which keyboard layout your are using, you can click the \emph{Figure out keyboard layout} button. This will opens a wizard which tries to determine your keyboard layout by having you a series of special characters.

\squashboxscreenshot{base/ubuntukeyboard.png}{Select your keyboard layout}{figubuntukeyboard}

Finally, you must create a user account. Enter your full name and, your desired username, and a password. If you are installing Ubuntu on a virtual machine, you can choose the \emph{Log me in automatically} option, to avoid having to enter your username and password every time your boot the machine. If, instead, you are doing the installation on a physical machine, you should use the default option \emph{Require my password to log in} (see figure \ref{figubuntuaccount}).

\squashboxscreenshot{base/ubuntuaccount.png}{Create an account}{figubuntuaccount}

When the installer has finished copying files and configuring the system, it is time to restart the virtual machine and start adding software to it.

The first time you start your machine, the Ubuntu Update Manager will examine your system and install all available updates. This can take a while. Once all updates have been installed you will have to restart your machine.

\squashboxhint{If you are installing on a virtual machine, now would be a good time to detach the Ubuntu Desktop CD image. Go to the VirtualBox Manager and choose \emph{Settings $\rightarrow$ Storage}. Select the Ubuntu CD image, click the small CD icon next to the drive dropdown list and select \emph{Remove disk from virtual drive}.}

% ----------------------------------------------------------------------------
\section{Install VirtualBox tools} \label{secinstallvirtualboxtools}

Once you have restarted your virtual machine and installed all available updates, you should take a few minutes to install the VirtualBox guest additions. These tools provide better integration between the guest operating system and the host operating system.

To install the tools, choose \emph{Devices $\rightarrow$ Install Guest Additions}. This will mount a CD image containing the VirtualBox tools in your Ubuntu machine. Go to \emph{Places $\rightarrow$ VBOXADDITIONS} to open the root of the CD and click the \emph{Open Autorun Prompt} to run the software from the CD. When you click \emph{Run} in the dialog that opens, the install script will install the necessary modules and extensions to integrate Ubuntu with the host system.

When the installation script has finished it job, you should restart the virtual machine to enable the newly installed features.

\squashboxhint{The VirtualBox tools make it easy to acces folders on the host machine from the virtual machine, and makes it easy to change the screen resolution of the virtual machine by simply changing the size of the window it is running in.}

% ============================================================================
\chapter{Servers} \label{chservers}
\chapterprecis{Install a database server and a web server with scripting support.}

\noindent
When the Ubuntu installion is complete and all available updates have been installed, it’s time to install the server software required to run Drupal, WordPress, or other PHP-based software.

We could install all the required software packages manually, but we are going to take advantage of the fact that Ubuntu provides a meta-package which installs the latest stable versions of the Apache web server, the MySQL database server and the PHP scripting language.

Open a terminal window by going to \emph{Applications $\rightarrow$ Accessories $\rightarrow$ Terminal} and run the following command to install Apache, MySQL and PHP:

\begin{squashboxcommand}
sudo apt-get install lamp-server^
\end{squashboxcommand}

When \verb!sudo! asks for a password, simply enter the password you created for your user account when you installed Ubuntu.

Apt-get displays a list of the packages which are about to be installed. Answer yes or press enter to start the installation. Apt-get will then download and install the required packages.
  
As part of the installation process, you will be asked for a password for the MySQL root user. You will need this password to configure the database server later.

Run the following command to install the remaining packages, which are not included in the meta-package:

\begin{squashboxcommand}
sudo apt-get install php5-cli php5-gd php5-xdebug
\end{squashboxcommand}

This command installs the following packages:

\begin{description}
\item[php5-cli] The PHP command-line interpreter
\item[php5-gd] GD support for PHP
\item[php5-xdebug] Xdebug support for PHP
\end{description}

Note that this version of \verb!php5-gd! uses the system GD library which doesn’t include all the functions which are included in the version of GD which is bundled with PHP. This means that functions like \verb!imagefilter()! and \verb!imagerotate()! will not be available. If you need access to these functions, you can follow this guide to compile your own version of the php5-gd package:

\squashboxlink{http://cumu.li/2008/5/13/recompiling-php5-with-bundled-support-for-gd-on-ubuntu}

% ============================================================================
\chapter{Development tools} \label{chdevtools}
\chapterprecis{Install an integrated development environment and a selection of useful browser plugins.}

\section{NetBeans}

\begin{squashboxcommand}
sudo apt-get install netbeans
\end{squashboxcommand}

%    * sudo apt-get install git gitk git-gui
%    * install firefox plugins

% TODO : Memory settings from http://groups.drupal.org/node/70258

\section{Version control}

\section{Firefox plugins}

% ============================================================================
\chapter{Install Drupal} \label{chinstalldrupal}
\chapterprecis{Install the latest stable and development versions of Drupal.}

% ============================================================================
\chapter{Caching} \label{chcaching}
\chapterprecis{Install an opcode cache and a reverse proxy server.}

\begin{squashboxcommand}
sudo apt-get install php5-apc memcached varnish
\end{squashboxcommand}

\part{Getting to work}

% ============================================================================
\chapter{Debugging} \label{chdebugging}
\chapterprecis{Speed up your development workflow with the installed tools.}

% ============================================================================
\chapter{Performance testing} \label{chperformance}
\chapterprecis{Identify bottlenecks in your application and get an idea of how it performs under simulated loads.}

\end{document}
